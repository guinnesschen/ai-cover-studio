
> ai-coverlab-processing@1.0.0 start
> node server.js

[YouTubeDownloader] Initialized with config: {
  tempDir: '/tmp',
  cookiesFile: null,
  maxRetries: 3,
  retryDelay: 2000,
  rateLimitDelay: 1000,
  verbose: true
}
üöÄ Processing service running on port 3001
üì• YouTube downloads: POST /download-youtube
üé¨ Video stitching: POST /stitch-video-audio
‚ù§Ô∏è  Health check: GET /health

[YouTube Download] Starting download for job test_1750586626948
[YouTube Download] URL: https://www.youtube.com/watch?v=dQw4w9WgXcQ
[YouTube Download] Using enhanced downloader with anti-bot detection

[YouTubeDownloader] Starting download for job test_1750586626948
[YouTubeDownloader] URL: https://www.youtube.com/watch?v=dQw4w9WgXcQ
[YouTubeDownloader] Output path: /tmp/test_1750586626948_audio.webm

[YouTubeDownloader] Download attempt 1/3 for job test_1750586626948
[YouTubeDownloader] Building options for attempt 1
[YouTubeDownloader] Using User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36
[YouTubeDownloader] Starting yt-dlp with options: {
  "output": "/tmp/test_1750586626948_audio.webm",
  "format": "bestaudio[ext=webm]/bestaudio[ext=m4a]/bestaudio",
  "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
  "referer": "https://www.youtube.com/",
  "addHeader": [
    "Accept-Language:en-US,en;q=0.9",
    "Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",
    "Accept-Encoding:gzip, deflate, br",
    "Cache-Control:no-cache",
    "Connection:keep-alive",
    "Sec-Fetch-Dest:document",
    "Sec-Fetch-Mode:navigate",
    "Sec-Fetch-Site:none",
    "Sec-Fetch-User:?1",
    "Upgrade-Insecure-Requests:1"
  ],
  "extractorArgs": "youtube:player_client=web,android,ios",
  "noPlaylist": true,
  "sleepInterval": 2,
  "maxSleepInterval": 4,
  "sleepSubtitles": 1
}
[YouTubeDownloader] yt-dlp completed successfully
[YouTubeDownloader] Result metadata: "[youtube] Extracting URL: https://www.youtube.com/watch?v=dQw4w9WgXcQ\n[youtube] dQw4w9WgXcQ: Downloading webpage\n[youtube] dQw4w9WgXcQ: Downloading iframe API JS\n[youtube] dQw4w9WgXcQ: Downloading web player API JSON\n[youtube] dQw4w9WgXcQ: Downloading android player API JSON\n[youtube] dQw4w9WgXcQ: Downloading ios player API JSON"
[YouTubeDownloader] Attempt 1 failed: Download completed but no file was created
[YouTubeDownloader] Waiting 2000ms before retry...

[YouTubeDownloader] Download attempt 2/3 for job test_1750586626948
[YouTubeDownloader] Building options for attempt 2
[YouTubeDownloader] Using User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36
[YouTubeDownloader] Attempt 2: trying alternative strategies
[YouTubeDownloader] Starting yt-dlp with options: {
  "output": "/tmp/test_1750586626948_audio.webm",
  "format": "bestaudio/best",
  "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36",
  "referer": "https://www.youtube.com/",
  "addHeader": [
    "Accept-Language:en-US,en;q=0.9",
    "Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",
    "Accept-Encoding:gzip, deflate, br",
    "Cache-Control:no-cache",
    "Connection:keep-alive",
    "Sec-Fetch-Dest:document",
    "Sec-Fetch-Mode:navigate",
    "Sec-Fetch-Site:none",
    "Sec-Fetch-User:?1",
    "Upgrade-Insecure-Requests:1"
  ],
  "extractorArgs": "youtube:player_client=web,android,ios",
  "noPlaylist": true,
  "sleepInterval": 1,
  "maxSleepInterval": 4,
  "sleepSubtitles": 1
}
[YouTubeDownloader] yt-dlp completed successfully
[YouTubeDownloader] Result metadata: "[youtube] Extracting URL: https://www.youtube.com/watch?v=dQw4w9WgXcQ\n[youtube] dQw4w9WgXcQ: Downloading webpage\n[youtube] dQw4w9WgXcQ: Downloading iframe API JS\n[youtube] dQw4w9WgXcQ: Downloading web player API JSON\n[youtube] dQw4w9WgXcQ: Downloading android player API JSON\n[youtube] dQw4w9WgXcQ: Downloading ios player API JSON"
[YouTubeDownloader] Attempt 2 failed: Download completed but no file was created
[YouTubeDownloader] Waiting 2000ms before retry...

[YouTubeDownloader] Download attempt 3/3 for job test_1750586626948
[YouTubeDownloader] Building options for attempt 3
[YouTubeDownloader] Using User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36
[YouTubeDownloader] Attempt 3: trying alternative strategies
[YouTubeDownloader] Starting yt-dlp with options: {
  "output": "/tmp/test_1750586626948_audio.webm",
  "format": "bestaudio[ext=webm]/bestaudio[ext=m4a]/bestaudio",
  "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
  "referer": "https://www.youtube.com/",
  "addHeader": [
    "Accept-Language:en-US,en;q=0.9",
    "Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",
    "Accept-Encoding:gzip, deflate, br",
    "Cache-Control:no-cache",
    "Connection:keep-alive",
    "Sec-Fetch-Dest:document",
    "Sec-Fetch-Mode:navigate",
    "Sec-Fetch-Site:none",
    "Sec-Fetch-User:?1",
    "Upgrade-Insecure-Requests:1"
  ],
  "extractorArgs": "youtube:player_client=tv_embedded,web,android",
  "noPlaylist": true,
  "sleepInterval": 1,
  "maxSleepInterval": 3,
  "sleepSubtitles": 1
}
[YouTubeDownloader] yt-dlp completed successfully
[YouTubeDownloader] Result metadata: "[youtube] Extracting URL: https://www.youtube.com/watch?v=dQw4w9WgXcQ\n[youtube] dQw4w9WgXcQ: Downloading webpage\n[youtube] dQw4w9WgXcQ: Downloading iframe API JS\n[youtube] dQw4w9WgXcQ: Downloading tv embedded player API JSON\n[youtube] dQw4w9WgXcQ: Downloading web player API JSON\n[youtube] dQw4w9WgXcQ: Downloading android player API JSON"
[YouTubeDownloader] Attempt 3 failed: Download completed but no file was created
[YouTubeDownloader] Download failed for job test_1750586626948: Error: Failed after 3 attempts. Last error: Download completed but no file was created
    at YouTubeDownloader.downloadWithRetry (file:///code/processing-service/youtube-downloader.js:210:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async YouTubeDownloader.download (file:///code/processing-service/youtube-downloader.js:223:22)
    at async file:///code/processing-service/server.js:77:22
[YouTube Download] Download failed: Error: Failed after 3 attempts. Last error: Download completed but no file was created
    at YouTubeDownloader.downloadWithRetry (file:///code/processing-service/youtube-downloader.js:210:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async YouTubeDownloader.download (file:///code/processing-service/youtube-downloader.js:223:22)
    at async file:///code/processing-service/server.js:77:22
[YouTube Download] Failed: Error: Failed after 3 attempts. Last error: Download completed but no file was created
    at YouTubeDownloader.downloadWithRetry (file:///code/processing-service/youtube-downloader.js:210:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async YouTubeDownloader.download (file:///code/processing-service/youtube-downloader.js:223:22)
    at async file:///code/processing-service/server.js:77:22
